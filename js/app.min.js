/**
 * Author: Robert Wilson
 * Date Created: 2024-09-12
 * Contact Information: robert@poltersanctuary.com
 * Github: https://github.com/polterx
 * License: Apache License, Version 2.0. See http://www.apache.org/licenses/LICENSE-2.0
*/

document.addEventListener('DOMContentLoaded',function(){initLanguageSelection();initFoundation();initScrollHideNavbar();initSectionScrolling();initMobileMenu();initOrbitSlider()});function initFoundation(){if(typeof $!=='undefined'&&$.fn.foundation){try{$(document).foundation();console.log('Foundation initialized successfully.')}catch(error){console.error('Error initializing Foundation:',error)}}else{console.error('Foundation or jQuery is not loaded.')}}function initScrollHideNavbar(){let prevScrollPos=window.pageYOffset;const navbar=document.querySelector('.navbar');window.addEventListener('scroll',function(){const currentScrollPos=window.pageYOffset;if(prevScrollPos>currentScrollPos){navbar.classList.remove('hidden');}else{navbar.classList.add('hidden');}prevScrollPos=currentScrollPos})}function initSectionScrolling(){const sections=document.querySelectorAll('section');const menuLinks=document.querySelectorAll('.nav-links a, .mobile-menu-link');let currentIndex=0;let isScrolling=false;function throttle(fn,wait){let time=Date.now();return function(){if(Date.now()-time>=wait){fn();time=Date.now()}}}function scrollToSection(index){isScrolling=true;sections[index].scrollIntoView({behavior:'smooth'});setActiveLink(index);currentIndex=index;setTimeout(()=>{isScrolling=false},800)}function setActiveLink(index){menuLinks.forEach(link=>link.classList.remove('active'));if(menuLinks[index]){menuLinks[index].classList.add('active')}}menuLinks.forEach((link,index)=>{link.addEventListener('click',function(e){e.preventDefault();scrollToSection(index)})});window.addEventListener('scroll',throttle(function(){if(isScrolling){return}let foundIndex=-1;sections.forEach((section,index)=>{const rect=section.getBoundingClientRect();if(rect.top<=window.innerHeight/2&&rect.bottom>=window.innerHeight/2){foundIndex=index}});if(foundIndex!==currentIndex&&foundIndex!==-1){setActiveLink(foundIndex);currentIndex=foundIndex}},150))}function initMobileMenu(){const hamburgerButton=document.getElementById('hamburger-button');const mobileMenuOverlay=document.getElementById('mobile-menu-overlay');const mobileMenuLinks=document.querySelectorAll('.mobile-menu-link');hamburgerButton.addEventListener('click',function(){mobileMenuOverlay.classList.toggle('active')});mobileMenuLinks.forEach(link=>{link.addEventListener('click',function(){mobileMenuOverlay.classList.remove('active');const targetId=link.getAttribute('href').substring(1);document.getElementById(targetId).scrollIntoView({behavior:'smooth'})})})}function initOrbitSlider(){$('.orbit').foundation({autoPlay:true,infiniteWrap:true,timerDelay:4000,swipe:true,pauseOnHover:true});const orbitSlider=new Foundation.Orbit($('.orbit'));document.querySelectorAll('.orbit-previous, .orbit-next').forEach(button=>{button.addEventListener('click',function(){orbitSlider.timer.restart()})});window.addEventListener('resize',function(){orbitSlider._reset()})}function initLanguageSelection(){document.querySelectorAll('.language-select').forEach(select=>{select.addEventListener('change',function(){const bookId=this.getAttribute('data-book');const languageCode=this.value.toUpperCase();const cardTitle=document.querySelector(`.card[data-book="${ bookId }"] .card-title`).textContent.trim();const formattedTitle=cardTitle.replace(/\s+/g,'-').toLowerCase();const linkId='download-link-'+bookId;const newHref=`assets/pdfs/salus-${ formattedTitle }-${languageCode.toLowerCase()}.pdf`;document.getElementById(linkId).href=newHref})})}
